#!/bin/bash

# ====================================================================
# Claude Hook: PostToolUse (官方事件)
# 触发时机: 工具成功完成后立即运行
# 作用: 在 Write/Edit 后提醒添加 AI 标记,在任务完成后提醒检查文档
#
# 注意: 此为 Shell Hook,通过文件名 post-tool-use 关联到 PostToolUse 事件
# ====================================================================

# 读取工具结果
TOOL_RESULT=$(cat)

# 尝试从输入中检测工具类型 (基于启发式规则)
# 注意: Shell hooks 可能无法像 JSON 配置那样获得明确的工具名

# 检测是否是 Write/Edit 操作 (通过结果特征)
if echo "$TOOL_RESULT" | grep -qiE "(File (created|updated)|successfully written)"; then
    # 代码编写/修改后,提醒添加 AI 标记
    cat <<EOF
$TOOL_RESULT

[提醒] 如果刚才写入的是 AI 新增代码,记得添加标记:
# --- ai start ---
# ========== 功能说明 (日期) ==========
[你的代码]
# --- ai end ---
EOF

# 检测是否是 Task 完成
elif echo "$TOOL_RESULT" | grep -qiE "(Task (complete|done)|任务完成|Agent completed)"; then
    cat <<EOF
$TOOL_RESULT

[提醒] 任务完成前检查清单:
✓ 是否需要创建/更新 guide.md?
✓ 是否需要记录新规则到 project-specific-rules.md?
✓ 是否已添加 AI 代码标记?
EOF

else
    # 其他情况,直接透传
    echo "$TOOL_RESULT"
fi
