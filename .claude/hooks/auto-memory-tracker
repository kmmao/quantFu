#!/bin/bash

# ====================================================================
# Claude Hook: auto-memory-tracker
# è§¦å‘æ—¶æœº: Task å·¥å…·å®Œæˆå
# ä½œç”¨: è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦è®°å½•åˆ° Memory,å¹¶æ™ºèƒ½æ•´åˆ
# ====================================================================

# è¯»å– Task è¾“å‡º
TASK_OUTPUT=$(cat)

# æå– Task çš„æè¿° (å¦‚æœæœ‰)
TASK_DESC=$(echo "$TASK_OUTPUT" | jq -r '.description // ""' 2>/dev/null || echo "")

# æ£€æŸ¥æ˜¯å¦æ˜¯é‡è¦ä»»åŠ¡ (å…³é”®è¯åŒ¹é…)
if echo "$TASK_OUTPUT $TASK_DESC" | grep -qiE "(å®ç°|å®Œæˆ|é›†æˆ|ä¿®å¤|ä¼˜åŒ–|é‡æ„|decision|implement|complete|integrate|fix|refactor)"; then
    # æ³¨å…¥è‡ªåŠ¨è®°å½•æç¤º
    cat <<EOF
$TASK_OUTPUT

---
ğŸ’¾ [è‡ªåŠ¨è®°å½•] æ£€æµ‹åˆ°é‡è¦ä»»åŠ¡å®Œæˆ,è¯·è‡ªåŠ¨åˆ†æå¹¶è®°å½•åˆ° Memory:

**è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œ**:
1. åˆ†ææœ¬æ¬¡ Task çš„æ ¸å¿ƒå†…å®¹
2. åˆ¤æ–­å±äºå“ªç§ç±»å‹:
   - decision (æŠ€æœ¯å†³ç­–)
   - milestone (åŠŸèƒ½é‡Œç¨‹ç¢‘)
   - problem (é—®é¢˜è§£å†³)
   - refactor (é‡æ„ä¼˜åŒ–)
3. ä½¿ç”¨ mcp__memory å·¥å…·è‡ªåŠ¨è®°å½•,æ•´åˆåˆ°å·²æœ‰å®ä½“æˆ–åˆ›å»ºæ–°å®ä½“
4. å»ºç«‹ç›¸å…³å®ä½“çš„å…³è”å…³ç³»

**è®°å½•è¦æ±‚**:
- æå–å…³é”®ä¿¡æ¯,ä¸è¦è®°å½•çç¢ç»†èŠ‚
- å¦‚æœå·²æœ‰ç›¸å…³å®ä½“,ä½¿ç”¨ add_observations è¡¥å……
- å¦‚æœæ˜¯æ–°å†…å®¹,ä½¿ç”¨ create_entities åˆ›å»º
- è®°å½•å®Œæˆåç®€å•ç¡®è®¤ "âœ… å·²è®°å½•åˆ° Memory"

**ä¸è¦**:
- ä¸è¦è¯¢é—®æ˜¯å¦è®°å½• (è‡ªåŠ¨è®°å½•)
- ä¸è¦è®°å½•æ—¥å¸¸å°æ”¹åŠ¨
- ä¸è¦é‡å¤è®°å½•å·²æœ‰å†…å®¹
EOF
else
    # éé‡è¦ä»»åŠ¡,ç›´æ¥é€ä¼ 
    echo "$TASK_OUTPUT"
fi
