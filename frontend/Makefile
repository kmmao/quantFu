# QuantFu å‰ç«¯ - Makefile
#
# å¿«é€Ÿå¼€å§‹:
#   make dev        - å¯åŠ¨å¼€å‘æœåŠ¡å™¨
#   make build      - æ„å»ºç”Ÿäº§ç‰ˆæœ¬
#   make test       - è¿è¡Œæµ‹è¯•

.PHONY: help dev build lint test test-ui clean
.PHONY: ui-add install

help: ## æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "  QuantFu å‰ç«¯ - å¯ç”¨å‘½ä»¤"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'
	@echo ""
	@echo "ğŸ’¡ æç¤º: ä¸»é¡¹ç›®å‘½ä»¤è¯·è¿”å›æ ¹ç›®å½•è¿è¡Œ 'make help'"
	@echo ""

# ==========================================
# å¼€å‘å‘½ä»¤
# ==========================================

dev: ## å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (http://localhost:3000)
	@echo "ğŸ¨ å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨..."
	@npm run dev

build: ## æ„å»ºç”Ÿäº§ç‰ˆæœ¬
	@echo "ğŸ—ï¸  æ„å»ºå‰ç«¯ç”Ÿäº§ç‰ˆæœ¬..."
	@npm run build
	@echo "âœ… æ„å»ºå®Œæˆ: .next/ ç›®å½•"

lint: ## ä»£ç æ£€æŸ¥
	@echo "ğŸ” æ£€æŸ¥ä»£ç è´¨é‡..."
	@npm run lint

lint-fix: ## è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜
	@echo "ğŸ”§ è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜..."
	@npm run lint -- --fix

# ==========================================
# æµ‹è¯•å‘½ä»¤
# ==========================================

test: ## è¿è¡Œæµ‹è¯•
	@echo "ğŸ§ª è¿è¡Œå‰ç«¯æµ‹è¯•..."
	@npm run test

test-ui: ## è¿è¡Œæµ‹è¯• (UI æ¨¡å¼)
	@echo "ğŸ§ª å¯åŠ¨æµ‹è¯• UI..."
	@npm run test:ui

test-watch: ## è¿è¡Œæµ‹è¯• (ç›‘å¬æ¨¡å¼)
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯• (ç›‘å¬æ¨¡å¼)..."
	@npm run test -- --watch

test-coverage: ## è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡..."
	@npm run test -- --coverage
	@echo "ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š: coverage/index.html"

# ==========================================
# ä¾èµ–ç®¡ç†
# ==========================================

install: ## å®‰è£…ä¾èµ–
	@echo "ğŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–..."
	@npm install
	@echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

update: ## æ›´æ–°ä¾èµ–
	@echo "ğŸ“¦ æ›´æ–°ä¾èµ–..."
	@npm update
	@echo "âœ… ä¾èµ–å·²æ›´æ–°"

check-deps: ## æ£€æŸ¥ä¾èµ–å®Œæ•´æ€§
	@echo "ğŸ” æ£€æŸ¥ä¾èµ–å®Œæ•´æ€§..."
	@npm ls --depth=0

# ==========================================
# UI ç»„ä»¶
# ==========================================

ui-add: ## æ·»åŠ  shadcn/ui ç»„ä»¶ (ä½¿ç”¨: make ui-add COMP=button)
	@if [ -z "$(COMP)" ]; then \
		echo "âŒ è¯·æŒ‡å®šç»„ä»¶åç§°"; \
		echo "   ç¤ºä¾‹: make ui-add COMP=button"; \
		echo ""; \
		echo "ğŸ“š å¯ç”¨ç»„ä»¶åˆ—è¡¨: https://ui.shadcn.com/docs/components"; \
		exit 1; \
	fi
	@echo "ğŸ“¦ æ·»åŠ  shadcn/ui ç»„ä»¶: $(COMP)..."
	@npx shadcn@latest add $(COMP) --yes
	@echo "âœ… ç»„ä»¶æ·»åŠ å®Œæˆ"

ui-list: ## åˆ—å‡ºå·²å®‰è£…çš„ shadcn/ui ç»„ä»¶
	@echo "ğŸ“¦ å·²å®‰è£…çš„ shadcn/ui ç»„ä»¶:"
	@if [ -d "components/ui" ]; then \
		ls -1 components/ui | sed 's/\.tsx$$//' | awk '{printf "  - %s\n", $$0}'; \
	else \
		echo "  (æ— )"; \
	fi

# ==========================================
# å¼€å‘å·¥å…·
# ==========================================

format: ## æ ¼å¼åŒ–ä»£ç  (ä½¿ç”¨ Prettier)
	@echo "âœ¨ æ ¼å¼åŒ–ä»£ç ..."
	@npx prettier --write "**/*.{ts,tsx,js,jsx,json,css,md}"
	@echo "âœ… æ ¼å¼åŒ–å®Œæˆ"

type-check: ## TypeScript ç±»å‹æ£€æŸ¥
	@echo "ğŸ” TypeScript ç±»å‹æ£€æŸ¥..."
	@npx tsc --noEmit
	@echo "âœ… ç±»å‹æ£€æŸ¥é€šè¿‡"

clean: ## æ¸…ç†æ„å»ºäº§ç‰©å’Œç¼“å­˜
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºäº§ç‰©..."
	@rm -rf .next node_modules/.cache
	@echo "âœ… æ¸…ç†å®Œæˆ"

clean-all: ## æ¸…ç†æ‰€æœ‰æ–‡ä»¶ (åŒ…æ‹¬ node_modules)
	@echo "âš ï¸  è­¦å‘Š: è¿™å°†åˆ é™¤ node_modules ç›®å½•!"
	@read -p "ç¡®è®¤åˆ é™¤? (y/N): " confirm && [ "$$confirm" = "y" ] || exit 1
	@rm -rf .next node_modules node_modules/.cache
	@echo "âœ… å·²æ¸…ç†æ‰€æœ‰æ–‡ä»¶"
	@echo "ğŸ’¡ é‡æ–°å®‰è£…ä¾èµ–: make install"

# ==========================================
# åˆ†æå’Œä¼˜åŒ–
# ==========================================

analyze: ## åˆ†ææ„å»ºäº§ç‰©å¤§å°
	@echo "ğŸ“Š åˆ†ææ„å»ºäº§ç‰©..."
	@ANALYZE=true npm run build
	@echo "âœ… åˆ†æå®Œæˆ"

# ==========================================
# æ—¥å¿—æŸ¥çœ‹
# ==========================================

logs: ## æŸ¥çœ‹å¼€å‘æ—¥å¿— (å¦‚æœæœ‰)
	@if [ -f "frontend.log" ]; then \
		echo "ğŸ” æŸ¥çœ‹å‰ç«¯æ—¥å¿— (Ctrl+C é€€å‡º)..."; \
		tail -f frontend.log; \
	else \
		echo "âŒ æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨: frontend.log"; \
		echo "ğŸ’¡ è¯·å…ˆå¯åŠ¨å¼€å‘ç¯å¢ƒ: cd .. && make dev"; \
	fi
